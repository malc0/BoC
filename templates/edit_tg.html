<!DOCTYPE html public "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title><TMPL_IF NAME=NAME><TMPL_VAR NAME=SN> transaction group "<TMPL_VAR NAME=NAME>"<TMPL_ELSE>Add <TMPL_VAR NAME=SN> transaction group</TMPL_IF></title>
		<TMPL_IF NAME=STYLE><link href="<TMPL_VAR NAME=STYLE>" rel="stylesheet" type="text/css"/></TMPL_IF>
		<style type="text/css">th.negated { font-style: italic } .unknown_d { background-color: red } td.unknown_u { background-color: red } tr.unknown_c { background-color: red } .tp { font-style: italic }</style>
	</head>
	<body>
		<form action="boc.pl" method="post" onsubmit="if ('save' in this && this.save.clicked) {
				this.save.clicked = false;
				var missing = '';
				var row = 0;
				while ('Creditor_' + row in this) {
					var amnt = this['Amount_' + row].value;
					var is_zero = (amnt.search(/^\s*$/) >= 0 || (amnt.search(/^\s*-?\d*[.,Â·]?\d*\s*$/) >= 0 && amnt == 0));
					if ((this['Creditor_' + row].value.search(/^TrnsfrPot\d$/) >= 0 || !is_zero) && this['Description_' + row].value.search(/^\s*$/) >= 0)
						missing += ' ' + row + ',';
					row++;
				}
				if (missing != '')
					return confirm ('Missing line description, row ' + missing + ' save anyway?');
			} return true">
		<div>
			<input type="hidden" name="tmpl" value="edit_tg"/>
			<TMPL_IF NAME=ETOKEN><input type="hidden" name="etoken" value="<TMPL_VAR NAME=ETOKEN>"/></TMPL_IF>
			<TMPL_IF NAME=TG_ID><input type="hidden" name="tg_id" value="<TMPL_VAR NAME=TG_ID>"/></TMPL_IF>

			<TMPL_IF NAME=RO><h1><TMPL_VAR NAME=NAME></h1><TMPL_ELSE><h1><TMPL_IF NAME=TG_ID>Edit<TMPL_ELSE>New</TMPL_IF> transaction group</h1>
			
			<h2><label>Transaction group name: <input type="text" value="<TMPL_VAR NAME=NAME>" name="tg_name"/></label></h2></TMPL_IF>

			<TMPL_IF NAME=RO><p>Date: <TMPL_VAR NAME=DATE></p><TMPL_ELSE><p><label>Date: <input type="text" value="<TMPL_VAR NAME=DATE>" name="tg_date"/></label></p></TMPL_IF>

			<p><label>Omit from inclusion?: <input type="checkbox" name="omit" value="" <TMPL_IF NAME=OMIT>checked="checked"</TMPL_IF> <TMPL_IF NAME=RO>disabled="disabled"</TMPL_IF>/></label></p>

			<table border=1 class="widetable">
				<tr><th rowspan=2>Creditor</th><th rowspan=2>Amount</th><TMPL_IF NAME=CURCOL><th rowspan=2>Currency</th></TMPL_IF><th colspan=<TMPL_VAR NAME=NOACCTS>>Debt share</th><th rowspan=2>Transfer Pot</th><th rowspan=2>Description</th></tr>
				<tr><TMPL_LOOP NAME=HEADINGS><th class="<TMPL_VAR NAME=HEAD_CL>"><TMPL_VAR NAME=H></th></TMPL_LOOP></tr>

				<TMPL_LOOP NAME=ROWS><tr class="<TMPL_VAR NAME=ROW_CL>">
					<td><TMPL_IF NAME=RO><TMPL_LOOP NAME=CREDS><TMPL_IF NAME=S><span class="<TMPL_VAR NAME=CR_CL>"><TMPL_VAR NAME=O></span></TMPL_IF><TMPL_IF 0><TMPL_VAR NAME=V></TMPL_IF></TMPL_LOOP><TMPL_ELSE>
						<select name="Creditor_<TMPL_VAR NAME=R>">
							<TMPL_LOOP NAME=CREDS><option value="<TMPL_VAR NAME=V>" class="<TMPL_VAR NAME=CR_CL>" <TMPL_IF NAME=S>selected="selected"</TMPL_IF>><TMPL_VAR NAME=O></option>
							</TMPL_LOOP>
						</select>
					</TMPL_IF></td>
					<td><TMPL_IF NAME=RO><TMPL_VAR NAME=A><TMPL_ELSE><div style="white-space: nowrap"><input type="text" value="<TMPL_VAR NAME=A>" name="Amount_<TMPL_VAR NAME=R>" onclick="this.select()"/><script>
						b = document.createElement('input');
						b.setAttribute('type', 'button');
						b.setAttribute('style', 'padding:0');
						b.setAttribute('value', '\u2190 \u03A3');
						b.onclick = function() {
							total = 0;
							for (i = 0; i < document.forms[0].elements.length; i++)
								if (document.forms[0].elements[i].name.search(/^[^A-Z].*_<TMPL_VAR NAME=R>$/) >= 0)
									total += parseFloat(document.forms[0].elements[i].value);
							document.forms[0].elements['Amount_<TMPL_VAR NAME=R>'].value = Math.round(total * 1000000) / 1000000;
						};
						document.forms[0].elements['Amount_<TMPL_VAR NAME=R>'].parentNode.appendChild(b);
						</script></div></TMPL_IF></td>
					<TMPL_IF NAME=CURCOL><td class="<TMPL_VAR NAME=CUR_CL>"><TMPL_IF NAME=RO><TMPL_LOOP NAME=CURS><TMPL_IF NAME=S><TMPL_VAR NAME=C></TMPL_IF></TMPL_LOOP><TMPL_ELSE>
						<select name="Currency_<TMPL_VAR NAME=R>">
							<TMPL_LOOP NAME=CURS><option value="<TMPL_VAR NAME=C>" <TMPL_IF NAME=S>selected="selected"</TMPL_IF>><TMPL_VAR NAME=C></option>
							</TMPL_LOOP>
						</select>
					</TMPL_IF></td></TMPL_IF>
					<TMPL_LOOP NAME=RC><td class="<TMPL_VAR NAME=D_CL>"><TMPL_IF NAME=RO><TMPL_VAR NAME=D><TMPL_ELSE><input type="text" value="<TMPL_VAR NAME=D>" name="<TMPL_VAR NAME=N>" onclick="this.select()"/></TMPL_IF></td>
					</TMPL_LOOP>
					<td><TMPL_IF NAME=RO><TMPL_IF NAME=TP><TMPL_VAR NAME=TP><TMPL_ELSE>N/A</TMPL_IF><TMPL_ELSE>
						<select name="TrnsfrPot_<TMPL_VAR NAME=R>">
							<option value="">N/A</option>
							<TMPL_LOOP NAME=TPS><option value="<TMPL_VAR NAME=V>" <TMPL_IF NAME=S>selected="selected"</TMPL_IF>><TMPL_VAR NAME=V></option>
							</TMPL_LOOP>
						</select>
					</TMPL_IF></td>
					<td><TMPL_IF NAME=RO><TMPL_VAR NAME=DESC><TMPL_ELSE><input type="text" value="<TMPL_VAR NAME=DESC>" name="Description_<TMPL_VAR NAME=R>"/></TMPL_IF></td>
				</tr>
				</TMPL_LOOP>
			</table>
			<TMPL_IF NAME=DEFCUR><p>All transactions denominated in <TMPL_VAR NAME=DEFCUR></p></TMPL_IF>

			<p><a href="boc.pl?serve=tg_help" onclick="window.open('boc.pl?serve=moo', 'foo','height=400,width=550,location=no,menubar=no,status=no,toolbar=no,resizeable=yes,scrollbars=yes')" target="foo" title="Opens in new window">Understanding the transaction group form</a></p>
			<p><TMPL_IF NAME=RO><TMPL_IF NAME=EDITOK><input type="submit" name="edit" value="Edit"/></TMPL_IF><TMPL_ELSE>
			<input type="submit" name="cancel" value="Cancel"/><input type="submit" name="save" value="Save" onclick="this.clicked = true"/></TMPL_IF></p>
			<TMPL_IF NAME=STATUS><p><b><TMPL_VAR NAME=STATUS></b></p></TMPL_IF>
			<TMPL_UNLESS NAME=ETOKEN><p><input type="submit" name="to_cp" value="Return to <TMPL_VAR NAME=SN> start page"/><input type="submit" name="manage_tgs" value="See all transaction groups"/></p></TMPL_UNLESS>
			<p><input type="submit" name="logout" value="Logout"/></p>
		</div>
		</form>
	</body>
</html>
